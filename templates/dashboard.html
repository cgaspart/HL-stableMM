<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time Market Maker Dashboard for USDHL/USDC on Hyperliquid">
    <title>Market Maker Dashboard - USDHL/USDC | Hyperliquid</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}?v=4">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Initializing Dashboard...</p>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo-section">
                    <div class="logo-icon">ðŸ“Š</div>
                    <div class="header-content">
                        <h1>Market Maker Dashboard</h1>
                        <p class="subtitle">
                            <span class="pair-badge">USDHL/USDC</span>
                            <span class="exchange-badge">Hyperliquid Spot</span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <button class="refresh-btn" id="refreshBtn" title="Refresh Data">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Key Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card profit-card">
                <div class="metric-header">
                    <div class="metric-icon-wrapper">
                        <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                    </div>
                    <div class="metric-label">Realized Profit (Net)</div>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="realizedProfit">$0.00</div>
                    <div class="metric-change positive" id="profitChange">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 14l5-5 5 5z"/>
                        </svg>
                        <span>+0.00%</span>
                    </div>
                </div>
            </div>

            <div class="metric-card volume-card">
                <div class="metric-header">
                    <div class="metric-icon-wrapper">
                        <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M18 17V9M13 17V5M8 17v-3"/>
                        </svg>
                    </div>
                    <div class="metric-label">Total Volume</div>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="totalVolume">$0.00</div>
                    <div class="metric-subtext" id="totalTrades">0 trades</div>
                </div>
            </div>

            <div class="metric-card position-card">
                <div class="metric-header">
                    <div class="metric-icon-wrapper">
                        <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M3 9h18M9 21V9"/>
                        </svg>
                    </div>
                    <div class="metric-label">Current Position</div>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="currentPosition">0 USDHL</div>
                    <div class="metric-subtext" id="avgPrice">Avg: $0.00000</div>
                </div>
            </div>

            <div class="metric-card balance-card">
                <div class="metric-header">
                    <div class="metric-icon-wrapper">
                        <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="4" width="22" height="16" rx="2"/>
                            <path d="M1 10h22"/>
                        </svg>
                    </div>
                    <div class="metric-label">USDC Balance</div>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="usdcBalance">$0.00</div>
                    <div class="metric-subtext" id="lastUpdate">Last update: --</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-card extra-large profit-chart">
                <div class="chart-header">
                    <div class="chart-title">
                        <svg class="chart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M7 12l4-4 4 4 6-6"/>
                        </svg>
                        <h2>Cumulative Profit</h2>
                        <span class="chart-subtitle">Net After Fees</span>
                    </div>
                    <div class="chart-controls">
                        <button class="btn-small active" data-range="all" data-chart="profit">All Time</button>
                        <button class="btn-small" data-range="7d" data-chart="profit">7 Days</button>
                        <button class="btn-small" data-range="24h" data-chart="profit">24 Hours</button>
                        <button class="btn-small" data-range="1h" data-chart="profit">1 Hour</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="profitChart"></canvas>
                </div>
                <div class="chart-stats">
                    <div class="chart-stat">
                        <span class="stat-label">Peak Profit</span>
                        <span class="stat-value" id="peakProfit">$0.00</span>
                    </div>
                    <div class="chart-stat">
                        <span class="stat-label">Avg Hourly</span>
                        <span class="stat-value" id="avgHourlyProfit">$0.00</span>
                    </div>
                </div>
            </div>

            <div class="chart-card extra-large">
                <div class="chart-header">
                    <div class="chart-title">
                        <svg class="chart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M3 9h18M9 21V9"/>
                        </svg>
                        <h2>Position History</h2>
                        <span class="chart-subtitle">Inventory Over Time</span>
                    </div>
                    <div class="chart-controls">
                        <button class="btn-small active" data-range="all" data-chart="position">All</button>
                        <button class="btn-small" data-range="24h" data-chart="position">24H</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="positionChart"></canvas>
                </div>
                <div class="chart-stats">
                    <div class="chart-stat">
                        <span class="stat-label">Max Position</span>
                        <span class="stat-value" id="maxPosition">0 USDHL</span>
                    </div>
                </div>
            </div>

            <div class="chart-card medium">
                <div class="chart-header">
                    <div class="chart-title">
                        <svg class="chart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M18 17V9M13 17V5M8 17v-3"/>
                        </svg>
                        <h2>Cumulative Volume</h2>
                        <span class="chart-subtitle">Last 24 Hours</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="volumeChart"></canvas>
                </div>
                <div class="chart-stats">
                    <div class="chart-stat">
                        <span class="stat-label">Current Total</span>
                        <span class="stat-value" id="total24hVolume">$0.00</span>
                    </div>
                    <div class="chart-stat">
                        <span class="stat-label">Avg Per Hour</span>
                        <span class="stat-value" id="avgHourlyVolume">$0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Open Positions Section -->
        <div class="activity-section">
            <div class="activity-header">
                <div class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h18v18H3V3z"/>
                        <path d="M3 9h18M9 21V9"/>
                    </svg>
                    <h2>Open Positions (FIFO Queue)</h2>
                    <span class="badge-info" title="Individual buy orders waiting to be sold">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01" stroke="white" stroke-width="2"/>
                        </svg>
                    </span>
                </div>
                <div class="trade-stats">
                    <span class="stat-badge neutral">
                        <span class="badge-label">Total Positions:</span>
                        <span id="totalOpenPositions">0</span>
                    </span>
                    <span class="stat-badge neutral">
                        <span class="badge-label">Total Amount:</span>
                        <span id="totalOpenAmount">0.00 USDHL</span>
                    </span>
                    <span class="stat-badge neutral">
                        <span class="badge-label">Avg Cost:</span>
                        <span id="openPositionsAvg">$0.00000</span>
                    </span>
                </div>
            </div>
            
            <div class="trades-table-container">
                <table class="trades-table">
                    <thead>
                        <tr>
                            <th>Order</th>
                            <th>Time</th>
                            <th>Amount</th>
                            <th>Cost Basis</th>
                            <th>Min Profitable</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="openPositionsTableBody">
                        <tr>
                            <td colspan="6" class="no-data">
                                <div class="loading-spinner small"></div>
                                <span>Loading positions...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

              <!-- Trade Activity Section -->
        <div class="activity-section">
            <div class="activity-header">
                <div class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2"/>
                    </svg>
                    <h2>Recent Trades</h2>
                </div>
                <div class="trade-stats">
                    <span class="stat-badge buy">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 14l5-5 5 5z"/>
                        </svg>
                        <span class="badge-label">Buys:</span>
                        <span id="totalBuys">0</span>
                    </span>
                    <span class="stat-badge sell">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 10l5 5 5-5z"/>
                        </svg>
                        <span class="badge-label">Sells:</span>
                        <span id="totalSells">0</span>
                    </span>
                </div>
            </div>
            
            <div class="trades-table-container">
                <table class="trades-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Side</th>
                            <th>Price</th>
                            <th>Amount</th>
                            <th>Total</th>
                            <th>Fee</th>
                        </tr>
                    </thead>
                    <tbody id="tradesTableBody">
                        <tr>
                            <td colspan="6" class="no-data">
                                <div class="loading-spinner small"></div>
                                <span>Loading trades...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Performance Insights -->
        <div class="insights-section">
            <div class="section-header">
                <div class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4M12 8h.01"/>
                    </svg>
                    <h2>Performance Insights</h2>
                </div>
            </div>
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <path d="M22 4L12 14.01l-3-3"/>
                        </svg>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">Win Rate</div>
                        <div class="insight-value" id="winRate">--%</div>
                        <div class="insight-description">Profitable trades ratio</div>
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">Avg Trade Size</div>
                        <div class="insight-value" id="avgTradeSize">$0.00</div>
                        <div class="insight-description">Average per trade</div>
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">Trades/Hour</div>
                        <div class="insight-value" id="tradesPerHour">0</div>
                        <div class="insight-description">Trading frequency</div>
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                            <path d="M22 12A10 10 0 0 0 12 2v10z"/>
                        </svg>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">Inventory Turnover</div>
                        <div class="insight-value" id="inventoryTurnover">0x</div>
                        <div class="insight-description">Position rotation</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <p>Market Maker Dashboard v2.0 â€¢ Real-time data updates every 5 seconds</p>
            <p class="footer-time">Last refresh: <span id="footerTime">--</span></p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
