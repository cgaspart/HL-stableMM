<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Maker Pro Dashboard - USDHL/USDC</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_v2.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"/>
                    <path d="M7 12l4-4 4 4 6-6"/>
                </svg>
                <span>MM Pro</span>
            </div>
        </div>
        
        <div class="nav-items">
            <a href="#overview" class="nav-item active" data-page="overview">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                </svg>
                <span>Overview</span>
            </a>
            
            <a href="#trading" class="nav-item" data-page="trading">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"/>
                    <path d="M7 12l4-4 4 4 6-6"/>
                </svg>
                <span>Trading</span>
            </a>
            
            <a href="#performance" class="nav-item" data-page="performance">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
                <span>Performance</span>
            </a>
            
            <a href="#risk" class="nav-item" data-page="risk">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                <span>Risk</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <div class="system-status" id="sidebarStatus">
                <div class="status-dot"></div>
                <span>Connecting...</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <h1 id="pageTitle">Overview</h1>
                <div class="market-badge">
                    <span class="pair">USDHL/USDC</span>
                    <span class="exchange">Hyperliquid</span>
                </div>
            </div>
            
            <div class="top-bar-right">
                <div class="live-price" id="livePrice">
                    <span class="label">Mid Price</span>
                    <span class="value">$--</span>
                    <span class="change">--</span>
                </div>
                
                <button class="icon-btn" id="refreshBtn" title="Refresh">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Page Container -->
        <div class="page-container">
            <!-- OVERVIEW PAGE -->
            <div class="page active" id="page-overview">
                <!-- System Health Banner -->
                <div class="health-banner" id="healthBanner">
                    <div class="health-status">
                        <div class="health-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <path d="M22 4L12 14.01l-3-3"/>
                            </svg>
                        </div>
                        <div class="health-info">
                            <h3 id="healthStatus">All Systems Operational</h3>
                            <p id="healthMessage">Bot is running smoothly</p>
                        </div>
                    </div>
                    <div class="health-metrics">
                        <div class="health-metric">
                            <span class="label">Last Update</span>
                            <span class="value" id="lastUpdateTime">--</span>
                        </div>
                        <div class="health-metric">
                            <span class="label">Last Trade</span>
                            <span class="value" id="lastTradeTime">--</span>
                        </div>
                        <div class="health-metric">
                            <span class="label">Errors (1h)</span>
                            <span class="value" id="errorCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics Grid -->
                <div class="metrics-grid-large">
                    <div class="metric-card-large profit">
                        <div class="metric-header">
                            <span class="metric-label">Realized P&L</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="realizedPnl">$0.00</div>
                        <div class="metric-change positive" id="pnlChange">+0.00%</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Unrealized P&L</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="unrealizedPnl">$0.00</div>
                        <div class="metric-change" id="unrealizedChange">0.00%</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Total Volume</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3v18h18"/>
                                <path d="M18 17V9M13 17V5M8 17v-3"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="totalVolume">$0</div>
                        <div class="metric-subtext" id="totalTrades">0 trades</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">ROI</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                                <path d="M22 12A10 10 0 0 0 12 2v10z"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="roiValue">0%</div>
                        <div class="metric-subtext">Return on Investment</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-row">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Cumulative Profit</h3>
                            <span class="chart-subtitle">Last 24 Hours</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="overviewProfitChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Position & Balance</h3>
                            <span class="chart-subtitle">Current Status</span>
                        </div>
                        <div class="position-display">
                            <div class="position-item">
                                <span class="position-label">Position</span>
                                <span class="position-value" id="currentPosition">0 USDHL</span>
                                <span class="position-avg" id="avgPrice">Avg: $0.00000</span>
                            </div>
                            <div class="position-item">
                                <span class="position-label">USDC Balance</span>
                                <span class="position-value" id="usdcBalance">$0.00</span>
                            </div>
                        </div>
                        <div class="chart-container small">
                            <canvas id="positionGaugeChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="activity-card">
                    <div class="activity-header">
                        <h3>Recent Trades</h3>
                        <span class="trade-count" id="recentTradeCount">0 trades</span>
                    </div>
                    <div class="trades-list" id="recentTradesList">
                        <div class="loading">Loading trades...</div>
                    </div>
                </div>
            </div>

            <!-- TRADING PAGE -->
            <div class="page" id="page-trading">
                <!-- Market Overview -->
                <div class="market-overview-grid">
                    <div class="market-card">
                        <div class="market-label">Best Bid</div>
                        <div class="market-value bid" id="bestBid">$0.00000</div>
                        <div class="market-depth" id="bidDepth">Depth: 0</div>
                    </div>
                    <div class="market-card">
                        <div class="market-label">Spread</div>
                        <div class="market-value spread" id="currentSpread">0.0 bps</div>
                        <div class="market-depth" id="spreadPct">0.00%</div>
                    </div>
                    <div class="market-card">
                        <div class="market-label">Best Ask</div>
                        <div class="market-value ask" id="bestAsk">$0.00000</div>
                        <div class="market-depth" id="askDepth">Depth: 0</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-row">
                    <div class="chart-card large">
                        <div class="chart-header">
                            <h3>Spread Over Time</h3>
                            <span class="chart-subtitle">Last 24 Hours</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="spreadChart"></canvas>
                        </div>
                        <div class="chart-stats">
                            <div class="stat-item">
                                <span class="stat-label">Avg Spread</span>
                                <span class="stat-value" id="avgSpread">0.0 bps</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Min Spread</span>
                                <span class="stat-value" id="minSpread">0.0 bps</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Max Spread</span>
                                <span class="stat-value" id="maxSpread">0.0 bps</span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Market Volatility</h3>
                            <span class="chart-subtitle">1 Hour Window</span>
                        </div>
                        <div class="volatility-display">
                            <div class="volatility-main">
                                <span class="volatility-value" id="volatilityValue">0.00%</span>
                                <span class="volatility-label">Volatility</span>
                            </div>
                            <div class="volatility-stats">
                                <div class="vol-stat">
                                    <span class="label">Price Change</span>
                                    <span class="value" id="priceChange1h">$0.00000</span>
                                </div>
                                <div class="vol-stat">
                                    <span class="label">High</span>
                                    <span class="value" id="high1h">$0.00000</span>
                                </div>
                                <div class="vol-stat">
                                    <span class="label">Low</span>
                                    <span class="value" id="low1h">$0.00000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Open Positions Table -->
                <div class="table-card">
                    <div class="table-header">
                        <h3>Open Positions (FIFO Queue)</h3>
                        <div class="table-stats">
                            <span class="stat-badge">Total: <strong id="totalPositions">0</strong></span>
                            <span class="stat-badge">Amount: <strong id="totalAmount">0 USDHL</strong></span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Order</th>
                                    <th>Time</th>
                                    <th>Amount</th>
                                    <th>Cost Basis</th>
                                    <th>Min Profitable</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="openPositionsTable">
                                <tr><td colspan="6" class="loading">Loading positions...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PERFORMANCE PAGE -->
            <div class="page" id="page-performance">
                <!-- Performance Metrics Grid -->
                <div class="metrics-grid-large">
                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Profit Factor</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <path d="M22 4L12 14.01l-3-3"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="profitFactor">0.00</div>
                        <div class="metric-subtext">Gross Profit / Gross Loss</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Win Rate</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="winRate">0%</div>
                        <div class="metric-subtext" id="winLossRatio">0 wins / 0 losses</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Total Fees</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2"/>
                                <path d="M1 10h22"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="totalFees">$0.00</div>
                        <div class="metric-subtext">Paid to Exchange</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Avg Profit/Trade</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="avgProfitPerTrade">$0.00</div>
                        <div class="metric-subtext">Per Completed Trade</div>
                    </div>
                </div>

                <!-- P&L Breakdown -->
                <div class="pnl-breakdown">
                    <div class="breakdown-tabs">
                        <button class="tab-btn active" data-period="daily">Daily</button>
                        <button class="tab-btn" data-period="weekly">Weekly</button>
                        <button class="tab-btn" data-period="monthly">Monthly</button>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>P&L Breakdown</h3>
                            <span class="chart-subtitle" id="pnlPeriodLabel">Daily Performance</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="pnlBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="charts-row">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Cumulative Profit</h3>
                            <span class="chart-subtitle">All Time</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="perfProfitChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Trade Distribution</h3>
                            <span class="chart-subtitle">Wins vs Losses</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="tradeDistChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RISK PAGE -->
            <div class="page" id="page-risk">
                <!-- Risk Metrics -->
                <div class="metrics-grid-large">
                    <div class="metric-card-large risk">
                        <div class="metric-header">
                            <span class="metric-label">Inventory Risk</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="inventoryRisk">0%</div>
                        <div class="metric-subtext" id="inventoryStatus">Low Risk</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Exposure</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="totalExposure">$0.00</div>
                        <div class="metric-subtext">Capital at Risk</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Max Position</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3v18h18"/>
                                <path d="M7 12l4-4 4 4 6-6"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="maxPositionValue">0</div>
                        <div class="metric-subtext">USDHL</div>
                    </div>

                    <div class="metric-card-large">
                        <div class="metric-header">
                            <span class="metric-label">Unrealized P&L</span>
                            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="metric-value" id="riskUnrealizedPnl">$0.00</div>
                        <div class="metric-change" id="riskUnrealizedChange">0.00%</div>
                    </div>
                </div>

                <!-- Inventory Heatmap -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Inventory Risk Heatmap</h3>
                        <span class="chart-subtitle">Position vs Max Position Over Time</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="inventoryHeatmapChart"></canvas>
                    </div>
                    <div class="heatmap-legend">
                        <div class="legend-item safe">
                            <span class="legend-color"></span>
                            <span>Safe (0-40%)</span>
                        </div>
                        <div class="legend-item moderate">
                            <span class="legend-color"></span>
                            <span>Moderate (40-70%)</span>
                        </div>
                        <div class="legend-item high">
                            <span class="legend-color"></span>
                            <span>High (70-90%)</span>
                        </div>
                        <div class="legend-item critical">
                            <span class="legend-color"></span>
                            <span>Critical (90-100%)</span>
                        </div>
                    </div>
                </div>

                <!-- Risk Charts -->
                <div class="charts-row">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Unrealized P&L Over Time</h3>
                            <span class="chart-subtitle">Mark-to-Market</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="unrealizedPnlChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Position History</h3>
                            <span class="chart-subtitle">Inventory Levels</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="riskPositionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/dashboard_v2.js') }}"></script>
</body>
</html>
